<!DOCTYPE html>
<html>
<head>
<title>NIM</title>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script>
<!--
if (window!= top)!
top.location.href=location.href
//-->    
</script>
<script>
 var z,sp,next_to_that
      a = new int_array(4)
    image=new Array()
    image[1]=new Image()
    image[1].src="empty.jpg"
    image[2]=new Image()
    image[2].src="SmallStone.png"
function one_way(row) {
    a[row]--
    document.images[(row-1)*(row-1)+a[row]].src=image[1].src
}
function player_draught(row) {
    if (a[1]+a[2]+a[3]+a[4]!=0) {
    if ((next_to_that==5 || next_to_that==6) && a[row]!=0) next_to_that=row
    if (next_to_that==row && a[row]!=0) one_way(row)
    if (a[1]+a[2]+a[3]+a[4]==0)
    alert("I won, sucker!");
    }
}
function m_way(row) {
    while (a[row]<sp) {
    sp--
    document.images[(row-1)*(row-1)+sp].src=image[1].src
    for (var j=1; j<1500; j++){}
    }
}
var im=134456
var ia=8121
var ic=28411
var iran
function randomize(){
    var now  =new Date()
    iran=now.getSeconds()
}
function chance(imax){
    iran=(iran*ia+ic) % im
    return(Math.floor(iran/im*imax))
}
function winning_position() {
    var q,r,s
    q=(a[1] ^ a[2] ^ a[3] ^ a[4])==0
    r=(a[1] | a[2] | a[3] | a[4])==1
    s=q ^ r
    return(s)
}
function computer_draught() {
    if (a[1]+a[2]+a[3]+a[4]!=0) {
    if (next_to_that!=5 && a[1]+a[2]+a[3]+a[4]!=0) {
    next_to_that=5
    z=chance(4)+1
    if (winning_position()) {
    while (a[z]==0) z=(z % 4)+1
    one_way(z)
} else {
    while (!winning_position()) {
    z=(z % 4)+1
    while (a[z]==0) z=(z % 4)+1
    sp=a[z]
    while (!winning_position() && a[z]!=0) a[z]--
    if (!winning_position()) a[z]=sp
    }
    m_way(z)
    }
}
for (var j=1; j<1500; j++){}
    if (a[1]+a[2]+a[3]+a[4]==0)
    alert("How did you win?!");
    }
}
function int_array(length) { this.length=length }
function new_game() {
    a[1]=1;a[2]=3;a[3]=5;a[4]=7
    next_to_that=6
    for (var i=0; i<=15; i++) document.images[i].src=image[2].src
    document.distribution.value="  "
}
function draw(nr) {
    var str=""
    str +=""
    alert(str)
    if (document.images[nr].src==image[2].src) {
    document.images[nr].src=image[2].src
    } else {
    document.images[nr].src=image[1].src
    }
}   
</script>
</head>
<style>
</style>
<body>
 <form>
<table BORDER=0 cellpadding="0" cellspacing="0" id="nim game">
<tr align="center" valign="top">
<td COLSPAN="3"></td>
<td width="10"><img SRC="SmallStone.png"></td>
<td COLSPAN="3"></td>
<td width="10" valign="middle"><input name="button" type="button" class="button" onClick="player_draught(1)" value="Row 1">
</td>
</tr>
<tr align="center" valign="top">
<td COLSPAN="2"></td>
<td width="10"><img SRC="SmallStone.png"></td>
<td width="10"><img SRC="SmallStone.png"></td>
<td width="10"><img SRC="SmallStone.png"></td>
<td COLSPAN="2"></td>
<td width="59" valign="middle"><input name="button2" type="button" class="button" onClick="player_draught(2)" value="Row 2">
</td>
</tr>
<tr align="center" valign="top">
<td width="10"></td>
<td width="10"><img SRC="SmallStone.png"></td>
<td width="10"><img SRC="SmallStone.png"></td>
<td width="10"><img SRC="SmallStone.png"></td>
<td width="10"><img SRC="SmallStone.png"></td>
<td width="10"><img SRC="SmallStone.png"></td>
<td width="10"></td>
<td width="59" valign="middle"><input name="button2" type="button" class="button" onClick="player_draught(3)" value="Row 3">
</td>
</tr>
<tr align="center" valign="top">
<td WIDTH="10"><img SRC="SmallStone.png"></td>
<td WIDTH="10"><img SRC="SmallStone.png"></td>
<td WIDTH="10"><img SRC="SmallStone.png"></td>
<td WIDTH="10"><img SRC="SmallStone.png"></td>
<td WIDTH="10"><img SRC="SmallStone.png"></td>
<td WIDTH="10"><img SRC="SmallStone.png"></td>
<td WIDTH="10"><img SRC="SmallStone.png"></td>
<td WIDTH="59" valign="middle"><input name="button2" type="button" class="button" onClick="player_draught(4)" value="Row 4">
</td>
</tr>
<tr align="center" valign="middle">
<td height="70" colspan="7"><input name="button2" type="button" class="button" onClick="new_game()" value="New game">
&nbsp;
<input name="button2" type="button" class="button" onClick="javascript:window.close()" value="Close window">
</td>
<td height="70"><input name="button2" type="button" class="button2" onClick="computer_draught()" value="PC move">
</td>
</tr>
</table>
</form>   
</body>
</html>